var checkoutForm=jQuery("form.checkout");function getSpinnerPath(e){for(var r=document.getElementsByTagName("script"),t=0;t<r.length;t++){var o=r[t].src;if(o.indexOf("fastspring-checkout")>-1)return o.substring(0,o.indexOf("fastspring-checkout"))+"../img/spin.svg"}return!1}function setLoading(){if(!document.getElementById("fscLoader")){var e=document.createElement("div");e.id="fscLoader",e.setAttribute("style","background: -webkit-linear-gradient(rgba(0,0,0,0.9), rgba(0,0,0,0.8)); background: -o-linear-gradient(rgba(0,0,0,0.9), rgba(0,0,0,0.8)); background: -moz-linear-gradient(rgba(0,0,0,0.9), rgba(0,0,0,0.8)); background: linear-gradient(rgba(0,0,0,0.9), rgba(0,0,0,0.8));"),e.style.width="100%",e.style.height="100%",e.style.position="fixed",e.style.top="0",e.style.left="0",e.style.zIndex="100000000000000",e.style.transitionProperty="opacity",e.style.transitionDuration="0.5s",e.style.opacity="0";var r=document.createElement("img");r.src=getSpinnerPath(),r.style.position="absolute",r.style.top="50%",r.style.marginTop="-50px",r.style.left="50%",r.style.marginLeft="-50px",r.style.zIndex="100000000000000",r.style.display="block",e.appendChild(r),document.body.appendChild(e),setTimeout(function(){e.style.opacity="1"},100)}}function setLoadingDone(){var e=document.getElementById("fscLoader");e&&e.remove(),checkoutForm.removeClass("processing")}function getAjaxURL(e){return woocommerce_fastspring_params.ajax_url.toString().replace("%%endpoint%%","wc_fastspring_"+e)}function fastspringPopupCloseHandler(e){setLoadingDone(),e&&e.reference&&requestPaymentCompletionUrl(e||{},function(e,r){e||(window.location=r.redirect_url)})}function requestPaymentCompletionUrl(e,r){e.security=woocommerce_fastspring_params.nonce.receipt,jQuery.ajax({type:"POST",dataType:"json",data:JSON.stringify(e),url:getAjaxURL("get_receipt"),success:function(e){r(null,e)},error:function(e,t,o){r(e.responseText)}})}function launchFS(e){fastspring.builder.secure(e.payload,e.key),fastspring.builder.checkout()}function setOrder(e){jQuery.ajax({type:"POST",url:wc_checkout_params.checkout_url,data:checkoutForm.serialize(),dataType:"json",success:function(r){try{if("success"!==r.result)throw"failure"===r.result?new Error("Result failure"):new Error("Invalid response");e(null,r)}catch(e){if(!0===r.reload)return void window.location.reload();!0===r.refresh&&jQuery(document.body).trigger("update_checkout"),r.messages?submitError(r.messages):submitError('<div class="woocommerce-error">'+wc_checkout_params.i18n_checkout_error+"</div>")}},error:function(e,r,t){submitError('<div class="woocommerce-error">'+t+"</div>")}})}function doSubmit(){checkoutForm.addClass("processing"),setLoading(),setOrder(function(e,r){e||(launchFS(r.session),document.getElementById("fscCanvas").remove())})}function submitError(e){jQuery(".woocommerce-NoticeGroup-checkout, .woocommerce-error, .woocommerce-message").remove(),checkoutForm.prepend('<div class="woocommerce-NoticeGroup woocommerce-NoticeGroup-checkout">'+e+"</div>"),checkoutForm.removeClass("processing"),checkoutForm.find(".input-text, select, input:checkbox").trigger("validate").blur(),jQuery("html, body").animate({scrollTop:jQuery("form.checkout").offset().top-100},1e3),jQuery(document.body).trigger("checkout_error")}checkoutForm.on("checkout_place_order",function(){return doSubmit(),!1});