var checkoutForm=jQuery("form.checkout");function getSpinnerPath(e){for(var t=document.getElementsByTagName("script"),r=0;r<t.length;r++){var o=t[r].src;if(o.indexOf("fastspring-checkout")>-1)return o.substring(0,o.indexOf("fastspring-checkout"))+"../img/spin.svg"}return!1}function setLoading(){if(!document.getElementById("fscLoader")){var e=document.createElement("div");e.id="fscLoader",e.setAttribute("style","background: -webkit-linear-gradient(rgba(0,0,0,0.9), rgba(0,0,0,0.8)); background: -o-linear-gradient(rgba(0,0,0,0.9), rgba(0,0,0,0.8)); background: -moz-linear-gradient(rgba(0,0,0,0.9), rgba(0,0,0,0.8)); background: linear-gradient(rgba(0,0,0,0.9), rgba(0,0,0,0.8));"),e.style.width="100%",e.style.height="100%",e.style.position="fixed",e.style.top="0",e.style.left="0",e.style.zIndex="-1",e.style.transitionProperty="opacity",e.style.transitionDuration="0.5s",e.style.opacity="0";var t=document.createElement("img");t.src=getSpinnerPath(),t.style.position="absolute",t.style.top="50%",t.style.marginTop="-50px",t.style.left="50%",t.style.marginLeft="-50px",t.style.zIndex="100000000000000",t.style.display="block",e.appendChild(t),document.body.appendChild(e)}}function setLoadingDone(){checkoutForm.removeClass("processing");var e=document.getElementById("fscLoader");e&&(e.style.zIndex="-1",e.style.display="hidden")}function setLoadingOn(){checkoutForm.addClass("processing");var e=document.getElementById("fscLoader");e&&(e.style.zIndex="100000000000000",setTimeout(function(){e.style.opacity="1"},100))}function getAjaxURL(e){return woocommerce_fastspring_params.ajax_url.toString().replace("%%endpoint%%","wc_fastspring_"+e)}function fastspringPopupCloseHandler(e){setLoadingDone(),e&&e.reference&&requestPaymentCompletionUrl(e||{},function(e,t){e||(window.location=t.redirect_url)})}function requestPaymentCompletionUrl(e,t){e.security=woocommerce_fastspring_params.nonce.receipt,jQuery.ajax({type:"POST",dataType:"json",data:JSON.stringify(e),url:getAjaxURL("get_receipt"),success:function(e){t(null,e)},error:function(e,r,o){t(e.responseText)}})}function launchFS(e){fastspring.builder.secure(e.payload,e.key),fastspring.builder.checkout(),disableFSOverlay()}function setOrder(e){jQuery.ajax({type:"POST",url:wc_checkout_params.checkout_url,data:checkoutForm.serialize(),dataType:"json",success:function(t){try{if("success"!==t.result)throw"failure"===t.result?new Error("Result failure"):new Error("Invalid response");e(null,t)}catch(e){if(!0===t.reload)return void window.location.reload();!0===t.refresh&&jQuery(document.body).trigger("update_checkout"),t.messages?submitError(t.messages):submitError('<div class="woocommerce-error">'+wc_checkout_params.i18n_checkout_error+"</div>")}},error:function(e,t,r){submitError('<div class="woocommerce-error">'+r+"</div>")}})}function doSubmit(){setLoadingOn(),setOrder(function(e,t){e||launchFS(t.session)})}function disableFSOverlay(){var e=document.getElementById("fscCanvas");e&&(e.style.display="none")}function submitError(e){jQuery(".woocommerce-NoticeGroup-checkout, .woocommerce-error, .woocommerce-message").remove(),checkoutForm.prepend('<div class="woocommerce-NoticeGroup woocommerce-NoticeGroup-checkout">'+e+"</div>"),checkoutForm.removeClass("processing"),checkoutForm.find(".input-text, select, input:checkbox").trigger("validate").blur(),jQuery("html, body").animate({scrollTop:jQuery("form.checkout").offset().top-100},1e3),jQuery(document.body).trigger("checkout_error")}checkoutForm.on("checkout_place_order",function(){return doSubmit(),!1}),setLoading();