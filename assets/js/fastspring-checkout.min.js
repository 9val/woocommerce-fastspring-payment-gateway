var checkoutForm=jQuery("form.checkout");function getAjaxURL(e){return woocommerce_fastspring_params.ajax_url.toString().replace("%%endpoint%%","wc_fastspring_"+e)}function fastspringPopupCloseHandler(e){e&&e.reference&&requestPaymentCompletionUrl(e||{},function(e,r){e||(window.location=r.redirect_url)})}function requestPaymentCompletionUrl(e,r){e.security=woocommerce_fastspring_params.nonce.receipt,jQuery.ajax({type:"POST",dataType:"json",data:JSON.stringify(e),url:getAjaxURL("get_receipt"),success:function(e){r(null,e)},error:function(e,o,c){r(e.responseText)}})}function requestPayload(e){var r={security:woocommerce_fastspring_params.nonce.receipt};jQuery.ajax({type:"POST",dataType:"json",data:JSON.stringify(r),url:getAjaxURL("get_payload"),success:function(r){e(null,r)},error:function(r,o,c){e(r.responseText)}})}function doSubmit(){checkoutForm.addClass("processing"),checkoutForm.data()["blockUI.isBlocked"],jQuery.ajax({type:"POST",url:wc_checkout_params.checkout_url,data:checkoutForm.serialize(),dataType:"json",success:function(e){try{if("success"!==e.result)throw"failure"===e.result?new Error("Result failure"):new Error("Invalid response");requestPayload(function(e,r){if(e)return submitError('<div class="woocommerce-error">'+wc_checkout_params.i18n_checkout_error+"</div>");fastspring.builder.secure(r.payload,r.key),fastspring.builder.checkout()})}catch(r){if(!0===e.reload)return void window.location.reload();!0===e.refresh&&jQuery(document.body).trigger("update_checkout"),e.messages?submitError(e.messages):submitError('<div class="woocommerce-error">'+wc_checkout_params.i18n_checkout_error+"</div>")}},error:function(e,r,o){submitError('<div class="woocommerce-error">'+o+"</div>")}})}function submitError(e){jQuery(".woocommerce-NoticeGroup-checkout, .woocommerce-error, .woocommerce-message").remove(),checkoutForm.prepend('<div class="woocommerce-NoticeGroup woocommerce-NoticeGroup-checkout">'+e+"</div>"),checkoutForm.removeClass("processing").unblock(),checkoutForm.find(".input-text, select, input:checkbox").trigger("validate").blur(),jQuery("html, body").animate({scrollTop:jQuery("form.checkout").offset().top-100},1e3),jQuery(document.body).trigger("checkout_error")}checkoutForm.on("checkout_place_order",function(){return doSubmit(),!1});